!function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=11)}([function(t,e,o){"use strict";var n;o.d(e,"a",function(){return n}),function(t){t[t.Trace=0]="Trace",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.None=4]="None"}(n||(n={}))},function(t,e,o){"use strict";class n{constructor(){this.isAborted=!1}abort(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.isAborted}}var r=o(3),s=o(0),i=o(2);o.d(e,"d",function(){return a}),o.d(e,"c",function(){return c}),o.d(e,"e",function(){return h}),o.d(e,"b",function(){return u}),o.d(e,"a",function(){return d});var a,c,l=function(t,e,o,n){return new(o||(o=Promise))(function(r,s){function i(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(i,a)}c((n=n.apply(t,e||[])).next())})};!function(t){t[t.WebSockets=0]="WebSockets",t[t.ServerSentEvents=1]="ServerSentEvents",t[t.LongPolling=2]="LongPolling"}(a||(a={})),function(t){t[t.Text=1]="Text",t[t.Binary=2]="Binary"}(c||(c={}));class h{constructor(t,e){this.logger=e,this.accessTokenFactory=t||(()=>null)}connect(t,e,o){if(i.a.isRequired(t,"url"),i.a.isRequired(e,"transferFormat"),i.a.isIn(e,c,"transferFormat"),i.a.isRequired(o,"connection"),"undefined"==typeof WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return this.logger.log(s.a.Trace,"(WebSockets transport) Connecting"),new Promise((o,n)=>{t=t.replace(/^http/,"ws");const r=this.accessTokenFactory();r&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);const i=new WebSocket(t);e===c.Binary&&(i.binaryType="arraybuffer"),i.onopen=(e=>{this.logger.log(s.a.Information,`WebSocket connected to ${t}`),this.webSocket=i,o()}),i.onerror=(t=>{n(t.error)}),i.onmessage=(t=>{this.logger.log(s.a.Trace,`(WebSockets transport) data received. ${g(t.data)}.`),this.onreceive&&this.onreceive(t.data)}),i.onclose=(t=>{this.onclose&&this.webSocket&&(!1===t.wasClean||1e3!==t.code?this.onclose(new Error(`Websocket closed with status code: ${t.code} (${t.reason})`)):this.onclose())})})}send(t){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.logger.log(s.a.Trace,`(WebSockets transport) sending data. ${g(t)}.`),this.webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()}}class u{constructor(t,e,o){this.httpClient=t,this.accessTokenFactory=e||(()=>null),this.logger=o}connect(t,e,o){if(i.a.isRequired(t,"url"),i.a.isRequired(e,"transferFormat"),i.a.isIn(e,c,"transferFormat"),i.a.isRequired(o,"connection"),"undefined"==typeof EventSource)throw new Error("'EventSource' is not supported in your environment.");return this.logger.log(s.a.Trace,"(SSE transport) Connecting"),this.url=t,new Promise((o,n)=>{e!==c.Text&&n(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));const r=this.accessTokenFactory();r&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);const i=new EventSource(t,{withCredentials:!0});try{i.onmessage=(t=>{if(this.onreceive)try{this.logger.log(s.a.Trace,`(SSE transport) data received. ${g(t.data)}.`),this.onreceive(t.data)}catch(t){return void(this.onclose&&this.onclose(t))}}),i.onerror=(t=>{n(new Error(t.message||"Error occurred")),this.eventSource&&this.onclose&&this.onclose(new Error(t.message||"Error occurred"))}),i.onopen=(()=>{this.logger.log(s.a.Information,`SSE connected to ${this.url}`),this.eventSource=i,o()})}catch(t){return Promise.reject(t)}})}send(t){return l(this,void 0,void 0,function*(){return p(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t)})}stop(){return this.eventSource&&(this.eventSource.close(),this.eventSource=null),Promise.resolve()}}class d{constructor(t,e,o){this.httpClient=t,this.accessTokenFactory=e||(()=>null),this.logger=o,this.pollAbort=new n}connect(t,e,o){if(i.a.isRequired(t,"url"),i.a.isRequired(e,"transferFormat"),i.a.isIn(e,c,"transferFormat"),i.a.isRequired(o,"connection"),this.url=t,this.logger.log(s.a.Trace,"(LongPolling transport) Connecting"),o.features.inherentKeepAlive=!0,e===c.Binary&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return this.poll(this.url,e),Promise.resolve()}poll(t,e){return l(this,void 0,void 0,function*(){const o={abortSignal:this.pollAbort.signal,headers:{},timeout:9e4};e===c.Binary&&(o.responseType="arraybuffer");const n=this.accessTokenFactory();for(n&&(o.headers.Authorization=`Bearer ${n}`);!this.pollAbort.signal.aborted;)try{const e=`${t}&_=${Date.now()}`;this.logger.log(s.a.Trace,`(LongPolling transport) polling: ${e}`);const n=yield this.httpClient.get(e,o);204===n.statusCode?(this.logger.log(s.a.Information,"(LongPolling transport) Poll terminated by server"),this.onclose&&this.onclose(),this.pollAbort.abort()):200!==n.statusCode?(this.logger.log(s.a.Error,`(LongPolling transport) Unexpected response code: ${n.statusCode}`),this.onclose&&this.onclose(new r.a(n.statusText,n.statusCode)),this.pollAbort.abort()):n.content?(this.logger.log(s.a.Trace,`(LongPolling transport) data received. ${g(n.content)}.`),this.onreceive&&this.onreceive(n.content)):this.logger.log(s.a.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(t){t instanceof r.b?this.logger.log(s.a.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.onclose&&this.onclose(t),this.pollAbort.abort())}})}send(t){return l(this,void 0,void 0,function*(){return p(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t)})}stop(){return this.pollAbort.abort(),Promise.resolve()}}function g(t){let e=null;return t instanceof ArrayBuffer?e=`Binary data of length ${t.byteLength}`:"string"==typeof t&&(e=`String data of length ${t.length}`),e}function p(t,e,o,n,r,i){return l(this,void 0,void 0,function*(){let a;r()&&(a={Authorization:`Bearer ${r()}`}),t.log(s.a.Trace,`(${e} transport) sending data. ${g(i)}.`);const c=yield o.post(n,{content:i,headers:a});t.log(s.a.Trace,`(${e} transport) request complete. Response status: ${c.statusCode}.`)})}},function(t,e,o){"use strict";o.d(e,"a",function(){return n});class n{static isRequired(t,e){if(null===t||void 0===t)throw new Error(`The '${e}' argument is required.`)}static isIn(t,e,o){if(!(t in e))throw new Error(`Unknown ${o} value: ${t}.`)}}},function(t,e,o){"use strict";o.d(e,"a",function(){return n}),o.d(e,"b",function(){return r});class n extends Error{constructor(t,e){const o=new.target.prototype;super(t),this.statusCode=e,this.__proto__=o}}class r extends Error{constructor(t="A timeout occurred."){const e=new.target.prototype;super(t),this.__proto__=e}}},function(t,e,o){"use strict";o.d(e,"b",function(){return r}),o.d(e,"a",function(){return i});var n=o(0);class r{log(t,e){}}class s{constructor(t){this.minimumLogLevel=t}log(t,e){if(t>=this.minimumLogLevel)switch(t){case n.a.Error:console.error(`${n.a[t]}: ${e}`);break;case n.a.Warning:console.warn(`${n.a[t]}: ${e}`);break;case n.a.Information:console.info(`${n.a[t]}: ${e}`);break;default:console.log(`${n.a[t]}: ${e}`)}}}class i{static createLogger(t){return void 0===t?new s(n.a.Information):null===t?new r:t.log?t:new s(t)}}},function(t,e,o){"use strict";o.d(e,"a",function(){return r});class n{constructor(t,e){this.subject=t,this.observer=e}dispose(){const t=this.subject.observers.indexOf(this.observer);t>-1&&this.subject.observers.splice(t,1),0===this.subject.observers.length&&this.subject.cancelCallback().catch(t=>{})}}class r{constructor(t){this.observers=[],this.cancelCallback=t}next(t){for(const e of this.observers)e.next(t)}error(t){for(const e of this.observers)e.error&&e.error(t)}complete(){for(const t of this.observers)t.complete&&t.complete()}subscribe(t){return this.observers.push(t),new n(this,t)}}},function(t,e,o){"use strict";o.d(e,"a",function(){return l});var n=o(7),r=o(0),s=o(4),i=o(1),a=o(2),c=function(t,e,o,n){return new(o||(o=Promise))(function(r,s){function i(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(i,a)}c((n=n.apply(t,e||[])).next())})};class l{constructor(t,e={}){this.features={},a.a.isRequired(t,"url"),this.logger=s.a.createLogger(e.logger),this.baseUrl=this.resolveUrl(t),(e=e||{}).accessTokenFactory=e.accessTokenFactory||(()=>null),this.httpClient=e.httpClient||new n.a(this.logger),this.connectionState=2,this.options=e}start(t){return a.a.isRequired(t,"transferFormat"),a.a.isIn(t,i.c,"transferFormat"),this.logger.log(r.a.Trace,`Starting connection with transfer format '${i.c[t]}'.`),2!==this.connectionState?Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state.")):(this.connectionState=0,this.startPromise=this.startInternal(t),this.startPromise)}startInternal(t){return c(this,void 0,void 0,function*(){try{if(this.options.transport===i.d.WebSockets)this.url=this.baseUrl,this.transport=this.constructTransport(i.d.WebSockets),yield this.transport.connect(this.url,t,this);else{const e=this.options.accessTokenFactory();let o;e&&(o={Authorization:`Bearer ${e}`});const n=yield this.getNegotiationResponse(o);if(2===this.connectionState)return;yield this.createTransport(this.options.transport,n,t,o)}this.transport.onreceive=this.onreceive,this.transport.onclose=(t=>this.stopConnection(!0,t)),this.changeState(0,1)}catch(t){throw this.logger.log(r.a.Error,"Failed to start the connection: "+t),this.connectionState=2,this.transport=null,t}})}getNegotiationResponse(t){return c(this,void 0,void 0,function*(){const e=this.resolveNegotiateUrl(this.baseUrl);this.logger.log(r.a.Trace,`Sending negotiation request: ${e}`);try{const o=yield this.httpClient.post(e,{content:"",headers:t});return JSON.parse(o.content)}catch(t){throw this.logger.log(r.a.Error,"Failed to complete negotiation with the server: "+t),t}})}updateConnectionId(t){this.connectionId=t.connectionId,this.url=this.baseUrl+(-1===this.baseUrl.indexOf("?")?"?":"&")+`id=${this.connectionId}`}createTransport(t,e,o,n){return c(this,void 0,void 0,function*(){if(this.updateConnectionId(e),this.isITransport(t))return this.logger.log(r.a.Trace,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,yield this.transport.connect(this.url,o,this),void this.changeState(0,1);const s=e.availableTransports;for(const a of s){this.connectionState=0;const s=this.resolveTransport(a,t,o);if("number"==typeof s){this.transport=this.constructTransport(s),null===e.connectionId&&(e=yield this.getNegotiationResponse(n),this.updateConnectionId(e));try{return yield this.transport.connect(this.url,o,this),void this.changeState(0,1)}catch(t){this.logger.log(r.a.Error,`Failed to start the transport '${i.d[s]}': ${t}`),this.connectionState=2,e.connectionId=null}}}throw new Error("Unable to initialize any of the available transports.")})}constructTransport(t){switch(t){case i.d.WebSockets:return new i.e(this.options.accessTokenFactory,this.logger);case i.d.ServerSentEvents:return new i.b(this.httpClient,this.options.accessTokenFactory,this.logger);case i.d.LongPolling:return new i.a(this.httpClient,this.options.accessTokenFactory,this.logger);default:throw new Error(`Unknown transport: ${t}.`)}}resolveTransport(t,e,o){const n=i.d[t.transport];if(null===n||void 0===n)this.logger.log(r.a.Trace,`Skipping transport '${t.transport}' because it is not supported by this client.`);else{const s=t.transferFormats.map(t=>i.c[t]);if(e&&n!==e)this.logger.log(r.a.Trace,`Skipping transport '${i.d[n]}' because it was disabled by the client.`);else if(s.indexOf(o)>=0){if(!(n===i.d.WebSockets&&"undefined"==typeof WebSocket||n===i.d.ServerSentEvents&&"undefined"==typeof EventSource))return this.logger.log(r.a.Trace,`Selecting transport '${i.d[n]}'`),n;this.logger.log(r.a.Trace,`Skipping transport '${i.d[n]}' because it is not supported in your environment.'`)}else this.logger.log(r.a.Trace,`Skipping transport '${i.d[n]}' because it does not support the requested transfer format '${i.c[o]}'.`)}return null}isITransport(t){return"object"==typeof t&&"connect"in t}changeState(t,e){return this.connectionState===t&&(this.connectionState=e,!0)}send(t){if(1!==this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State.");return this.transport.send(t)}stop(t){return c(this,void 0,void 0,function*(){const e=this.connectionState;this.connectionState=2;try{yield this.startPromise}catch(t){}this.stopConnection(1===e,t)})}stopConnection(t,e){this.transport&&(this.transport.stop(),this.transport=null),e?this.logger.log(r.a.Error,`Connection disconnected with error '${e}'.`):this.logger.log(r.a.Information,"Connection disconnected."),this.connectionState=2,t&&this.onclose&&this.onclose(e)}resolveUrl(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if("undefined"==typeof window||!window||!window.document)throw new Error(`Cannot resolve '${t}'.`);const e=window.document.createElement("a");e.href=t;const o=e.protocol&&":"!==e.protocol?`${e.protocol}//${e.host}`:`${window.document.location.protocol}//${e.host||window.document.location.host}`;t&&"/"===t[0]||(t="/"+t);const n=o+t;return this.logger.log(r.a.Information,`Normalizing '${t}' to '${n}'.`),n}resolveNegotiateUrl(t){const e=t.indexOf("?");let o=t.substring(0,-1===e?t.length:e);return"/"!==o[o.length-1]&&(o+="/"),o+="negotiate",o+=-1===e?"":t.substring(e)}}},function(t,e,o){"use strict";o.d(e,"a",function(){return a});var n=o(3),r=o(0);class s{constructor(t,e,o){this.statusCode=t,this.statusText=e,this.content=o}}class i{get(t,e){return this.send(Object.assign({},e,{method:"GET",url:t}))}post(t,e){return this.send(Object.assign({},e,{method:"POST",url:t}))}}class a extends i{constructor(t){super(),this.logger=t}send(t){return new Promise((e,o)=>{const i=new XMLHttpRequest;i.open(t.method,t.url,!0),i.withCredentials=!0,i.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.headers&&Object.keys(t.headers).forEach(e=>i.setRequestHeader(e,t.headers[e])),t.responseType&&(i.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=(()=>{i.abort()})),t.timeout&&(i.timeout=t.timeout),i.onload=(()=>{t.abortSignal&&(t.abortSignal.onabort=null),i.status>=200&&i.status<300?e(new s(i.status,i.statusText,i.response||i.responseText)):o(new n.a(i.statusText,i.status))}),i.onerror=(()=>{this.logger.log(r.a.Warning,`Error from HTTP request. ${i.status}: ${i.statusText}`),o(new n.a(i.statusText,i.status))}),i.ontimeout=(()=>{this.logger.log(r.a.Warning,"Timeout from HTTP request."),o(new n.b)}),i.send(t.content||"")})}}},function(t,e,o){"use strict";var n=o(6),r=o(0),s=o(4);class i{static write(t){return`${t}${i.RecordSeparator}`}static parse(t){if(t[t.length-1]!==i.RecordSeparator)throw new Error("Message is incomplete.");const e=t.split(i.RecordSeparator);return e.pop(),e}}i.RecordSeparatorCode=30,i.RecordSeparator=String.fromCharCode(i.RecordSeparatorCode);var a=o(1);const c="json";class l{constructor(){this.name=c,this.version=1,this.transferFormat=a.c.Text}parseMessages(t,e){if(!t)return[];null===e&&(e=new s.b);const o=i.parse(t),n=[];for(const t of o){const o=JSON.parse(t);if("number"!=typeof o.type)throw new Error("Invalid payload.");switch(o.type){case 1:this.isInvocationMessage(o);break;case 2:this.isStreamItemMessage(o);break;case 3:this.isCompletionMessage(o);break;case 6:case 7:break;default:e.log(r.a.Information,"Unknown message type '"+o.type+"' ignored.");continue}n.push(o)}return n}writeMessage(t){return i.write(JSON.stringify(t))}isInvocationMessage(t){this.assertNotEmptyString(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this.assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")}isStreamItemMessage(t){if(this.assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")}isCompletionMessage(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.assertNotEmptyString(t.error,"Invalid payload for Completion message."),this.assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")}assertNotEmptyString(t,e){if("string"!=typeof t||""===t)throw new Error(e)}}var h=o(5);o.d(e,"a",function(){return g}),o.d(e,!1,function(){return l});var u=function(t,e,o,n){return new(o||(o=Promise))(function(r,s){function i(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(i,a)}c((n=n.apply(t,e||[])).next())})};const d=3e4;class g{constructor(t,e={}){e=e||{},this.timeoutInMilliseconds=e.timeoutInMilliseconds||d,this.protocol=e.protocol||new l,this.connection="string"==typeof t?new n.a(t,e):t,this.logger=s.a.createLogger(e.logger),this.connection.onreceive=(t=>this.processIncomingData(t)),this.connection.onclose=(t=>this.connectionClosed(t)),this.callbacks={},this.methods={},this.closedCallbacks=[],this.id=0}processIncomingData(t){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(t=this.processHandshakeResponse(t),this.receivedHandshakeResponse=!0),t){const e=this.protocol.parseMessages(t,this.logger);for(const t of e)switch(t.type){case 1:this.invokeClientMethod(t);break;case 2:case 3:const e=this.callbacks[t.invocationId];null!=e&&(3===t.type&&delete this.callbacks[t.invocationId],e(t));break;case 6:break;case 7:this.logger.log(r.a.Information,"Close message received from server."),this.connection.stop(t.error?new Error("Server returned an error on close: "+t.error):null);break;default:this.logger.log(r.a.Warning,"Invalid message type: "+t.type)}}this.configureTimeout()}processHandshakeResponse(t){let e,o,n;try{if(t instanceof ArrayBuffer){const e=new Uint8Array(t),r=e.indexOf(i.RecordSeparatorCode);if(-1===r)throw new Error("Message is incomplete.");const s=r+1;o=String.fromCharCode.apply(null,e.slice(0,s)),n=e.byteLength>s?e.slice(s).buffer:null}else{const e=t,r=e.indexOf(i.RecordSeparator);if(-1===r)throw new Error("Message is incomplete.");const s=r+1;o=e.substring(0,s),n=e.length>s?e.substring(s):null}const s=i.parse(o);e=JSON.parse(s[0])}catch(t){const e="Error parsing handshake response: "+t;this.logger.log(r.a.Error,e);const o=new Error(e);throw this.connection.stop(o),o}if(e.error){const t="Server returned handshake error: "+e.error;this.logger.log(r.a.Error,t),this.connection.stop(new Error(t))}else this.logger.log(r.a.Trace,"Server handshake complete.");return n}configureTimeout(){this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(()=>this.serverTimeout(),this.timeoutInMilliseconds))}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}invokeClientMethod(t){const e=this.methods[t.target.toLowerCase()];if(e){if(e.forEach(e=>e.apply(this,t.arguments)),t.invocationId){const t="Server requested a response, which is not supported in this version of the client.";this.logger.log(r.a.Error,t),this.connection.stop(new Error(t))}}else this.logger.log(r.a.Warning,`No client method with the name '${t.target}' found.`)}connectionClosed(t){const e=this.callbacks;this.callbacks={},Object.keys(e).forEach(o=>{(0,e[o])(void 0,t||new Error("Invocation canceled due to connection being closed."))}),this.cleanupTimeout(),this.closedCallbacks.forEach(e=>e.apply(this,[t]))}start(){return u(this,void 0,void 0,function*(){this.logger.log(r.a.Trace,"Starting HubConnection."),this.receivedHandshakeResponse=!1,yield this.connection.start(this.protocol.transferFormat),this.logger.log(r.a.Trace,"Sending handshake request."),yield this.connection.send(i.write(JSON.stringify({protocol:this.protocol.name,version:this.protocol.version}))),this.logger.log(r.a.Information,`Using HubProtocol '${this.protocol.name}'.`),this.cleanupTimeout(),this.configureTimeout()})}stop(){return this.logger.log(r.a.Trace,"Stopping HubConnection."),this.cleanupTimeout(),this.connection.stop()}stream(t,...e){const o=this.createStreamInvocation(t,e),n=new h.a(()=>{const t=this.createCancelInvocation(o.invocationId),e=this.protocol.writeMessage(t);return delete this.callbacks[o.invocationId],this.connection.send(e)});this.callbacks[o.invocationId]=((t,e)=>{e?n.error(e):3===t.type?t.error?n.error(new Error(t.error)):n.complete():n.next(t.item)});const r=this.protocol.writeMessage(o);return this.connection.send(r).catch(t=>{n.error(t),delete this.callbacks[o.invocationId]}),n}send(t,...e){const o=this.createInvocation(t,e,!0),n=this.protocol.writeMessage(o);return this.connection.send(n)}invoke(t,...e){const o=this.createInvocation(t,e,!1);return new Promise((t,e)=>{this.callbacks[o.invocationId]=((o,n)=>{if(n)e(n);else if(3===o.type){const n=o;n.error?e(new Error(n.error)):t(n.result)}else e(new Error(`Unexpected message type: ${o.type}`))});const n=this.protocol.writeMessage(o);this.connection.send(n).catch(t=>{e(t),delete this.callbacks[o.invocationId]})})}on(t,e){t&&e&&(t=t.toLowerCase(),this.methods[t]||(this.methods[t]=[]),-1===this.methods[t].indexOf(e)&&this.methods[t].push(e))}off(t,e){if(!t)return;t=t.toLowerCase();const o=this.methods[t];if(o)if(e){const n=o.indexOf(e);-1!==n&&(o.splice(n,1),0===o.length&&delete this.methods[t])}else delete this.methods[t]}onclose(t){t&&this.closedCallbacks.push(t)}cleanupTimeout(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)}createInvocation(t,e,o){if(o)return{arguments:e,target:t,type:1};{const o=this.id;return this.id++,{arguments:e,invocationId:o.toString(),target:t,type:1}}}createStreamInvocation(t,e){const o=this.id;return this.id++,{arguments:e,invocationId:o.toString(),target:t,type:4}}createCancelInvocation(t){return{invocationId:t,type:5}}}},function(t,e){},function(t,e,o){"use strict";o(3),o(7),o(6);var n=o(8);o.d(e,"HubConnection",function(){return n.a});o(9),o(0),o(4),o(1),o(5)},function(t,e,o){"use strict";o.r(e);var n={Play:"播放",Pause:"暫停","Current Time":"目前時間","Duration Time":"總共時間","Remaining Time":"剩餘時間","Stream Type":"串流類型",LIVE:"直播",Loaded:"載入完畢",Progress:"進度",Fullscreen:"全螢幕","Non-Fullscreen":"退出全螢幕",Mute:"靜音",Unmute:"取消靜音","Playback Rate":" 播放速率",Subtitles:"字幕","subtitles off":"關閉字幕",Captions:"內嵌字幕","captions off":"關閉內嵌字幕",Chapters:"章節","Close Modal Dialog":"關閉對話框",Descriptions:"描述","descriptions off":"關閉描述","Audio Track":"音軌","You aborted the media playback":"影片播放已終止","A network error caused the media download to fail part-way.":"網路錯誤導致影片下載失敗。","The media could not be loaded, either because the server or network failed or because the format is not supported.":"影片因格式不支援或者伺服器或網路的問題無法載入。","The media playback was aborted due to a corruption problem or because the media used features your browser did not support.":"由於影片檔案損毀或是該影片使用了您的瀏覽器不支援的功能，播放終止。","No compatible source was found for this media.":"無法找到相容此影片的來源。","The media is encrypted and we do not have the keys to decrypt it.":"影片已加密，無法解密。","Play Video":"播放影片",Close:"關閉","Modal Window":"對話框","This is a modal window":"這是一個對話框","This modal can be closed by pressing the Escape key or activating the close button.":"可以按ESC按鍵或啟用關閉按鈕來關閉此對話框。",", opens captions settings dialog":", 開啟標題設定對話框",", opens subtitles settings dialog":", 開啟字幕設定對話框",", opens descriptions settings dialog":", 開啟描述設定對話框",", selected":", 選擇","captions settings":"字幕設定","Audio Player":"音頻播放器","Video Player":"視頻播放器",Replay:"重播","Progress Bar":"進度小節","Volume Level":"音量","subtitles settings":"字幕設定","descriptions settings":"描述設定",Text:"文字",White:"白",Black:"黑",Red:"紅",Green:"綠",Blue:"藍",Yellow:"黃",Magenta:"紫紅",Cyan:"青",Background:"背景",Window:"視窗",Transparent:"透明","Semi-Transparent":"半透明",Opaque:"不透明","Font Size":"字型尺寸","Text Edge Style":"字型邊緣樣式",None:"無",Raised:"浮雕",Depressed:"壓低",Uniform:"均勻",Dropshadow:"下陰影","Font Family":"字型庫","Proportional Sans-Serif":"比例無細體","Monospace Sans-Serif":"單間隔無細體","Proportional Serif":"比例細體","Monospace Serif":"單間隔細體",Casual:"輕便的",Script:"手寫體","Small Caps":"小型大寫字體",Reset:"重置","restore all settings to the default values":"恢復全部設定至預設值",Done:"完成","Caption Settings Dialog":"字幕設定視窗","Beginning of dialog window. Escape will cancel and close the window.":"開始對話視窗。離開會取消及關閉視窗","End of dialog window.":"結束對話視窗","Now Playing":"播放中","Untitled Video":"無標題影片","Up Next":"接著播放","Video Name":"影片名稱","Video Description":"影片描述"};function r(t){const e=document.createElement("canvas");e.width=640,e.height=480;const o=e.getContext("2d");return o.fillStyle="#FFF",o.fillRect(0,0,e.width,e.height),o.fillStyle="#000",o.font="48px serif",o.fillText(t||"Video",10,50),e.toDataURL()}var s={webApiRoot:__owl__,webApiGetVideoList:"/api/Video/GetVideoList",webApiPlayVideo:"/api/Video/PlayVideo",signalrApi:"/videohub",signalrChannelPlay:"play",defaultPoster:r(),defaultType:"video/mp4",defaultName:n["Video Name"],defaultDescription:n["Video Description"]},i=(()=>({showLoading:()=>{const t=document.getElementsByClassName("loading-mask-disable");t.length>0&&(t[0].className="loading-mask")},hideLoading:()=>{const t=document.getElementsByClassName("loading-mask");t.length>0&&(t[0].className="loading-mask-disable")},showLogo:()=>{const t=document.getElementsByClassName("logo-mask-disable");t.length>0&&(t[0].className="logo-mask")},hideLogo:()=>{const t=document.getElementsByClassName("logo-mask");t.length>0&&(t[0].className="logo-mask-disable")}}))();var a={getAppConfig:function(t){return new Promise((e,o)=>{if(console.log(window.location.search),window.location.search){const o=window.location.search.substring(1).split("&"),n=Object.assign({},t);o.forEach(t=>{let e=t.split("=");n[e[0]]=e[1]}),e(n)}else e(t)})},getVideoList:function(t){return fetch(t,{method:"get"}).then(t=>t.json())}},c=o(10),l=t=>new Promise((e,o)=>{const n=new c.HubConnection(t.webApiRoot+t.signalrApi);n.start().then(t=>{console.log("initial"),e(n)}).catch(t=>{console.log("noneApi"),i.hideLoading(),i.showLogo(),o(null)})});r();function h(t,e){return e.webApiRoot+e.webApiPlayVideo+"?code="+t.code}var u={covertToPlayList:function(t,e){let o=[];for(let n=0;n<t.length;n++)o.push({name:t[n].categoryName||e.defaultName,description:t[n].description||e.defaultDescription,sources:[{src:h(t[n],e),type:e.defaultType}],poster:t[n].poster||e.defaultPoster,thumbnail:[{src:e.defaultPoster}]});return o},generateVideoParams:h},d=t=>{if(document.exitFullscreen&&document.exitFullscreen(),p.pause(),p.playlist([]),p.playlist.autoadvance(),0===t.length)return i.hideLoading(),void i.showLogo();const e=u.covertToPlayList(t,g.config);p.playlist(e),p.playlist.autoadvance(0),p.playlist.first(),i.hideLoading(),i.hideLogo()};o.d(e,"sloth",function(){return g}),o.d(e,"player",function(){return p}),i.showLoading(),i.hideLogo(),videojs.addLanguage("zh-tw",n);var g={},p=videojs("video-learning-player",{language:"zh-tw",speed:[{text:"x0.5",rate:.5},{text:"x1",rate:1,selected:!0},{text:"x2",rate:2}]});p.playlist([]),p.playlistUi(),p.playlist.autoadvance(0),function t(e){a.getAppConfig(s).then(o=>{i.showLoading(),e.config=o,l(e.config).then(o=>{o&&(a.getVideoList(e.config.webApiRoot+e.config.webApiGetVideoList).then(t=>{d(t)}),o.on("playVideo",function(t){window.location.reload()}),o.on("loginOk",function(t){console.log(t)}),o.onclose(()=>{setTimeout(t(e),1e4)}))},()=>{setTimeout(t(e),1e4)})})}(g)}]);